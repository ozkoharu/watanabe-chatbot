# ########################################################
# ##################### Baseステージ ######################
# ########################################################
# ビルドコンテキストはプロジェクトルートディレクトリとする。
FROM python:3.12.1 AS base

WORKDIR /var/www/src

RUN pip install --upgrade pip
RUN pip install poetry

RUN poetry config virtualenvs.create false

# ########################################################
# #################### テスト用ステージ ####################
# ########################################################
FROM base as test


# ########################################################
# ################### 開発環境用ステージ ####################
# ########################################################
FROM base as dev
RUN pip install alembic

EXPOSE 8080

# ########################################################
# ################### 本番環境用ステージ ####################
# ########################################################
FROM base as prod
EXPOSE 8080
RUN poetry install
CMD ["sh", "-c", "uvicorn chatbot.main:app --host 0.0.0.0 --port 8080"]
